(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(o){if(o.ep)return;o.ep=!0;const a=t(o);fetch(o.href,a)}})();let c="light";function l(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function h(){const n=document.getElementById("themeIcon");n&&(n.textContent=c==="dark"?"☀️":"🌙")}function d(n){const e=document.body;e.classList.remove("theme-light","theme-dark"),e.classList.add(`theme-${n}`),e.style.display="none",e.offsetHeight,e.style.display="",c=n,h(),console.log(`Applied theme: ${n}, Body classes:`,e.className)}function m(){const n=c==="light"?"dark":"light";d(n),g(`Switched to ${n==="light"?"Light Theme":"Dark Theme"}`,"info"),console.log(`Theme changed to: ${n}`)}function u(){document.querySelectorAll("button").forEach(e=>{e.addEventListener("click",function(){this.classList.add("loading"),setTimeout(()=>this.classList.remove("loading"),500)})})}function p(){document.querySelectorAll("textarea").forEach(e=>{e.addEventListener("input",function(){this.style.height="auto",this.style.height=`${Math.max(120,this.scrollHeight)}px`})})}function g(n,e="info"){const t=document.createElement("div");t.style.cssText=`
    position: fixed;
    top: 80px;
    right: 20px;
    background: ${e==="success"?"#4CAF50":e==="error"?"#F44336":"#2196F3"};
    color: white;
    padding: 12px 24px;
    border-radius: var(--border-radius);
    font-family: var(--font-family);
    font-weight: 500;
    font-size: 0.9rem;
    z-index: 1000;
    box-shadow: var(--shadow);
    transform: translateX(100%);
    transition: transform 0.3s ease;
    max-width: 250px;
    word-wrap: break-word;
  `,t.textContent=n,document.body.appendChild(t),setTimeout(()=>t.style.transform="translateX(0)",10),setTimeout(()=>{t.style.transform="translateX(100%)",setTimeout(()=>t.remove(),300)},3e3)}function f(){const n=l();d(n),u(),p(),document.querySelector(".theme-toggle")?.addEventListener("click",m)}class y{apiBase;wsBase;peerConn;dataChannel=null;ws=null;constructor(e,t){this.peerConn=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]}),this.apiBase=e,this.wsBase=t}async createRoom(){const t=await(await fetch(`${this.apiBase}/api/rooms/create`,{method:"POST"})).json();return this.connectWebSocket(t.roomId,t.clientId),t}async joinRoom(e){const s=await(await fetch(`${this.apiBase}/api/rooms/join?roomId=${e}`,{method:"POST"})).json();return this.connectWebSocket(s.roomId,s.clientId),s}connectWebSocket(e,t){this.ws=new WebSocket(`${this.wsBase}/ws?roomId=${e}&clientId=${t}`),this.ws.onopen=()=>{this.log("websocket connected ✅"),this.initWebRtc()},this.ws.onmessage=s=>{const o=JSON.parse(s.data);this.handleSignalingMessage(o)}}sendSignalToWS(e){this.ws?.send(JSON.stringify(e))}initWebRtc(){this.peerConn.onicecandidate=e=>{e.candidate&&this.sendSignalToWS({type:"candidate",data:e.candidate})},this.peerConn.ondatachannel=e=>{this.dataChannel=e.channel,this.setupDataChannel()}}handleSignalingMessage(e){switch(e.type){case"role":e.data?.role==="offerer"&&(this.dataChannel=this.peerConn.createDataChannel("chat"),this.setupDataChannel(),this.peerConn.createOffer().then(t=>{this.peerConn.setLocalDescription(t),this.sendSignalToWS({type:"offer",data:t})}));break;case"offer":this.peerConn.setRemoteDescription(new RTCSessionDescription(e.data)),this.peerConn.createAnswer().then(t=>{this.peerConn.setLocalDescription(t),this.sendSignalToWS({type:"answer",data:t})});break;case"answer":this.peerConn.setRemoteDescription(e.data);break;case"candidate":this.peerConn.addIceCandidate(new RTCIceCandidate(e.data));break;case"timeout":this.log("❌",e.message);break}}setupDataChannel(){this.dataChannel.onopen=()=>this.log("📡 Data channel open"),this.dataChannel.onmessage=e=>this.log("📩 Received:",e.data)}sendWebRTCmessage(e){this.dataChannel?.readyState==="open"&&this.dataChannel.send(e)}log(...e){const t=document.getElementById("log");if(!t)return;const s=document.createElement("div");s.className="log-entry",s.textContent=e.join(" "),t.appendChild(s),t.scrollTop=t.scrollHeight}}document.addEventListener("DOMContentLoaded",()=>{f()});const w="https://192.168.110.220:1337",C="wss://192.168.110.220:1337",i=new y(w,C),T=document.getElementById("create-room");T?.addEventListener("click",async()=>{const n=await i.createRoom();i.log("room created",JSON.stringify(n))});const b=document.getElementById("join-room");b?.addEventListener("click",async()=>{const e=document.getElementById("roomId")?.value.trim();if(e){const t=await i.joinRoom(e);i.log("room joined",JSON.stringify(t))}else alert("empty room id, cannot join")});const I=document.getElementById("sendMsg");I?.addEventListener("click",async()=>{const e=document.getElementById("messageInput")?.value.trim();e?i.sendWebRTCmessage(e):alert("empty message, cannot send")});
